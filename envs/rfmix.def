Bootstrap: localimage
From: /scratch.global/coffm049/baseImage/base.sif

%files
    rfmix.yml /app/environment.yml

    # Data
    /projects/standard/gdc/public/Ref/hgdp1kg.filtered.SNV_INDEL.38.phased.shapeit5
    # /projects/standard/gdc/public/Ref/CrossMap/GRCh37_to_GRCh38.chain.gz
    /projects/standard/gdc/public/Ref/rfmix_ref/hg38_phased.vcf.gz
    /projects/standard/gdc/public/Ref/rfmix_ref/super_population_map_file.txt
    /projects/standard/gdc/public/Ref/rfmix_ref/genetic_map_hg38.txt
    /projects/standard/gdc/public/Ref/RFMIX2-Pipeline-to-plot
    /projects/standard/gdc/public/Ref/ancestry_OG

%environment
    export LC_ALL=C
    # This ensures that when you type 'java', it finds the one in the Conda env
    export PATH="/bin:/opt/conda/bin:/opt/conda/envs/rfmix/bin:/usr/bin:$PATH"

%post
    # 1. Install ONLY build tools via apt (Removed openjdk)
    apt-get update && apt-get install -y \
        curl \
        tar \
        git \
        build-essential \
        && apt-get clean && rm -rf /var/lib/apt/lists/*

    # 2. Directory Setup
    mkdir -p /opt/bin

    # 3. Conda Setup (Java is installed here now via environment.yml)
    micromamba create --yes -f /app/environment.yml
    micromamba clean --all -f -y


%labels
    Author coffm049@umn.edu
    Version v0.1
    Description RFMIX and SHAPEIT container
