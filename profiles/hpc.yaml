# -----------------------------------------------------------------------------
# SNAKEMAKE HPC PROFILE (SLURM)
# -----------------------------------------------------------------------------

# --- 1. Execution Settings ---
executor: cluster-generic
cluster-generic-submit-cmd:
  mkdir -p logs/slurm/{rule} &&
  sbatch
    --parsable
    --partition={resources.partition}
    --qos={resources.qos}
    --cpus-per-task={threads}
    --mem={resources.mem_mb}
    --time={resources.time}
    --job-name=smk-{rule}-{wildcards}
    --output=logs/slurm/{rule}/{rule}-{wildcards}-%j.out
    --error=logs/slurm/{rule}/{rule}-{wildcards}-%j.err

cluster-generic-cancel-cmd: scancel

# --- 2. Job Control ---
jobs: 100                   # Max concurrent jobs on the cluster
latency-wait: 60            # Wait 60s for files to appear (essential for GPFS/Panasas)
keep-going: false            # If one job fails, keep running independent jobs
rerun-incomplete: false      # If a job crashed mid-write, re-run it automatically
printshellcmds: true        # Show the shell command in the log (good for debugging)

# --- 3. Resource Defaults ---
# These are used if a rule doesn't specify them
default-resources:
  qos: "normal"
  mem_mb: 4000              
  time: "08:00:00"          
  threads: 1

# --- 4. Singularity / Apptainer ---
use-singularity: true
# Note: We rely on the APPTAINER_BIND env var we set in the Snakefile/SBATCH
# But you can force binds here if you prefer:
# singularity-args: "--bind /scratch.global,/panfs,/home"

# --- 5. Retries ---
restart-times: 0            # Try a job one more time if it fails (good for random network blips)
